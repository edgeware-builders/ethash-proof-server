import { assert } from 'chai';
import { decodeHeader, encodeHeader, getProof } from '../src/utils';

describe('Ethash Proof Tests', () => {
  const encoded = '0xf9020ea042519b6b00775fd32186c32bb9f4c2ff9bc7423cacf3637dfe60e1772f42de21a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493479499c85bb64564d9ef9a99621301f22c9993cb89e3a01203a9e011144de43d8a258b5e24df7be30c10e42fbf97db776c54d13626cff9a0dd3a088e0c15e8146be3b65e01bcf63d542319b9f896d6ace4ce1a05a112aecca0db8e6ca034deeba63e88997e36603635cc272161376f66e24fa74ca8fe761218b90100a621022050600000020824c0a0029084001084100404200420412f21102991060018841083e0101790a62000400005c0531440004f8185c00001000b15202004090810cb10004c127ac0010851847020128202024072258090501b2180812298942600000680800300300000021018a3031004201887169008a8b1101300040400288120080c5984824888485808809800a0893911ca118e0144514a001809020e1f860801483100420049a4081488000090041090a0800420882608102060400088802a28803a50684004458184208420207213440800180428184a1000688100302c302900d0198c4000c0180020260008000202b108420a0082400802104887084f5a1ec537c6839c28918396a95e83969c9d845ee000dd8d626565706f6f6c2e6f72675f36a0767d1b618b91b0b80004ea857ec3784a761b3301ae19ea684e12e1d3f0f8c840883886642f565fcc48';

  it('should decode the header', () => {
    const decoded = decodeHeader(encoded);
    const reEncoded = encodeHeader(decoded);
    assert.equal(Buffer.from(reEncoded).toString('hex'), encoded.slice(2));
  });

  it('should generate the proof of the header', async () => {
    const proof = await getProof(encoded);
    assert.equal(proof.header_rlp, encoded);
  }).timeout(10000);
});
